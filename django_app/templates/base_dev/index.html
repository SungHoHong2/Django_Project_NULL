{% extends 'base_dev/base.html' %}
{% block content %}
{% load staticfiles %}


<script src="{% static 'base_dev/js/opening/jquery.gridly.js' %}"></script>
<script src="{% static 'base_dev/js/opening/materialize-tags.js' %}"></script>
<link rel="stylesheet" href="{% static 'base_dev/css/opening/jquery.gridly.css' %}">
<link rel="stylesheet" href="{% static 'base_dev/css/opening/materialize-tags.css' %}">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">




<!-- login 페이지 스크립트 -->
<script>
	$(document).ready(function(){
        $('.login-btn').click(function(){
			_this = $(this);
			var form_data = new FormData();
			form_data.append("username",$('input[name=username]').val());
			form_data.append("password",$('input[name=password]').val());

			formAjax('POST', form_data, "{% url 'member:login' %}"
					, 'application/json'
					, function(response){
							if(response.error){
									$('.err-modal').text("아이디와 비밀번호를 다시 확인해주세요.")
												   .css({
														  'color':'#f33d33',
														  'margin-top' : '10px',
														  'font-size' : '14px'
														});
							}else{
									_this.attr('disabled',true);
									location.href = "{% url 'member:around_me' %}"
							}

			});
        });
	});
</script>


<!-- register 페이지 스크립트 -->
<script>
	$(document).ready(function(){
		$('#loading').hide();
		$('.hidden_class').hide();

		/*
		 * 닉네임 중복여부 확인
		 */

		$('#join-name').keyup(function(e){
				$('.hidden_class').hide();
				$('input[name=password_1]').val('');
				$('input[name=password_2]').val('');

				if (e.keyCode == 13 || e.keyCode == 9){
					$('#nickname_div').empty();
				  if(String($('#join-name').val()).length==0){
					   $("#alert_related_text").tmpl({'text':'이름을 입력하십시오'}).appendTo( "#nickname_div" );
					   return false;
				   }

					postAjax('POST', {'nickname' : $('#join-name').val()}, "{% url 'member:nickname_duplicate' %}"
						, 'application/x-www-form-urlencoded', function(response){
								if(!response.response){
								$('.password-join-form').show();
								}else{
								$("#alert_related_text").tmpl({'text':'중복된 사용자 이름입니다.'}).appendTo( "#nickname_div" );
								}
					});
				};

		});

		/*
		 * 비밀 번호 일치여부 확인
		 */

		$('input[name=password_1]').keyup(function(){
		  $('#password_div').empty();
			var password = $(this).val();

			if (password.length < 8){
			   $("#alert_related_text").tmpl({'text':'암호 길이가 짧습니다.'}).appendTo( "#password_div" );
				 $('.img_hash_join_class').hide();
				return false;
			}

			var hasUpperCase = /[A-Z]/.test(password);
			var hasLowerCase = /[a-z]/.test(password);
			var hasNumbers = /\d/.test(password);
			var hasNonalphas = /\W/.test(password);
			if (hasUpperCase + hasLowerCase + hasNumbers + hasNonalphas < 3 ){
			   $("#alert_related_text").tmpl({'text':'암호에 대문자, 숫자를 섞어서 사용해주십시오'}).appendTo( "#password_div" );
				 $('.img_hash_join_class').hide();
			   return false;
			}else if($('input[name=password_1]').val()!=$('input[name=password_2]').val()){
				 $("#alert_related_text").tmpl({'text':'암호가 불일치합니다.'}).appendTo( "#password_div" );
				 $('.img_hash_join_class').hide();
				 return false;
			}


		});

		$('input[name=password_2]').keyup(function(){
			$('#password_div').empty();
			if($('input[name=password_1]').val()!=$('input[name=password_2]').val()){
			   $("#alert_related_text").tmpl({'text':'암호가 불일치합니다.'}).appendTo( "#password_div" );
				 $('.img_hash_join_class').hide();
			}else{
				 $('.img_hash_join_class').show();
			}
		});


		/*
		 * 이미지 파일 첨부
		 */

		$("#id_img_file").change(function(){
			var _this = $(this);
			_this.attr('disabled',true);
			var img_length = $('#img_upload_div').find('div').length;
			if(img_length==5){
				alert('이미지는 5개까지 입력 가능합니다.');
				return false;
			}

			var form_data = new FormData();
					form_data.append("img_file",$('input[name=img_file]')[0].files[0])
					formAjax_loading('POST', form_data, "{% url 'collection:temp_image' %}"
							, 'application/json',$('#loading'),$('.img-btn')
							, function(response){
								$('#loading').hide();
								$('.img-btn').show();

								_this.removeAttr('disabled');

									var img_div = $('#img_upload_div').append(
									     $('<div/>').addClass('brick small').attr('id',response.id)
									      	        .append($('<a/>').addClass('delete').text('x'))
									   	 );
									$('#id_img_file').val('');


									var img_div = document.querySelectorAll('.brick')[img_length];
									img_div.style['background-image'] = 'url('+response.img_file.replace('/img/','/small/')+')';
									img_div.style['left'] = 160 * img_length;
									img_length++;

									event.preventDefault();
  								event.stopPropagation();
  								$('.gridly').append(img_div);
  								return $('.gridly').gridly();
					});
		});

		$('.gridly').gridly({
				base: 60,
				gutter: 10,
				columns: 12
		});

		$('.img-btn').click(function(){
			$('#id_img_file').trigger('click');
		});

		$(document).on("click", ".gridly .delete", function(event) {
      		var $this;
      		event.preventDefault();
      		event.stopPropagation();
      		$this = $(this);
      		$this.closest('.brick').remove();
      		return $('.gridly').gridly('layout');
  	});


		/*
		 * 해시 태그 등록
		 */

		$('.n-tag').keyup(function(e) {
		    if (e.keyCode == 13 || e.keyCode == 9){
						$(this).val('');
				};
		});


		/*
		 * 회원 등록
		 */

		$('.join-btn').click(function(){
				var form_data = $("#register_form").serialize();

				$('#image_file_ids').val('');
				$($('#img_upload_div').find('div')).each(function(index, item){
						var image_id = $(item).attr('id');
						var text = $('#image_file_ids').val();
						if(text.length>0){
							text+=','
						}
						text+=image_id;
						$('#image_file_ids').val(text);
				})

			 $('#hash_tag_names').val('');
			 $($('.materialize-tags').find('span')).each(function(index, item){
				   var tag_name = String($(item).text()).replace('close','');
					 var text = $('#hash_tag_names').val();
					 if(text.length>0){ text+=',' }
					 text+= tag_name;
					 $('#hash_tag_names').val(text);
			 });


			var form_data = new FormData();
			form_data.append("username",$('#join-name').val());
			form_data.append("password_1",$('input[name=password_1]').val());
			form_data.append("password_2",$('input[name=password_2]').val());

			if($('#image_file_ids').val().length != 0){
				form_data.append("image_file_ids",$('#image_file_ids').val());
		  }

			if($('#hash_tag_names').val().length != 0){
				form_data.append("hash_tag_names",$('#hash_tag_names').val());
			}

			formAjax('POST', form_data, "{% url 'member:register' %}"
					, 'application/json'
					, function(response){
							if(response.response){
									location.href="{% url 'member:around_me' %}";
							}else{

									alert('error baby');

							}

			});

		});
	});


</script>

<script id="alert_related_text" type="text/x-jquery-tmpl">
		<div class="col-5" style="margin: auto; color: red;">
			${ text }
		</div>
</script>



<main>

<div class="slider-wrapper">
<ul class="slider">

<li>
	<!-- 로그인 페이지 -->
	<div class="page-1 container">
		<div class="content-box col-3">
			<h2>Log in Here!</h2>
	 		<div role="form" id="login_form" class="form-group" method="POST" action="{% url 'member:login' %}">
			<!-- {{  login_form.as_p }} -->
				<form autocomplete="off">
				<fieldset>
					<legend class="hidden">로그인 폼</legend>
					<div class="n-form">
						<label for="user-id" class="form-label">Name</label>
						<input type="text" id="user-id" name="username" class="form-input" required>
					</div>
					<div class="pw-form">
						<label for="user-pw" class="form-label">Password</label>
						<input type="password" id="user-pw" name="password" class="form-input" required>
					</div>
				</fieldset>
				</form>
				<button type="submit" class="login-btn">Login</button>
				<p class="err-modal"></p>
			</div>
				<div class="not-member">
					<p class="go-to-join-btn">아직 회원이 아니신가요?</p>
					<div>
						<a class="link-btn">회원가입</a>
						<a href="#" class="sns-login">소셜 계정으로 로그인</a>
					</div>
				</div>
			</div>
	<div class="visual col-5"></div>
	</div>
</li>

<li>
	<!-- register 페이지 -->
	<div class="page-2 container">
		<div class="visual2 col-4"></div>
		<div class="content-box col-4">

			<h2>Join Us!</h2>

			<div id="register_form" role="form" class="form-group" method="POST" action="{% url 'member:register' %}">
				<!-- {{ register_form.as_p }} -->
				<form action="" autocomplete="off">
				<fieldset>
					<legend class="hidden">회원가입 폼</legend>
					<div class="n-form ">
						<label for="join-name" class="form-label">Name</label>
						<input type="text" id="join-name" name="username" class="form-input" required placeholder="닉네임을 입력해주세요">
					</div>
					<div id="nickname_div"></div>
					<div class="pw-form hidden_class password-join-form">
						<label for="join-ps" class="form-label">Password</label>
						<input type="password" id="join-ps" name="password_1" class="form-input" required placeholder="비밀번호를 입력해주세요">
					</div>
					<div class="ps-cf-form hidden_class password-join-form">
						<label for="join-ps-cf" class="form-label">Password 확인</label>
						<input type="password" id="join-ps-cf" name="password_2" class="form-input" required placeholder="비밀번호를 재입력해주세요">
					</div>
					<div id="password_div"></div>

					<div id="img_upload_div" class="col-5 gridly img_hash_join_class hidden_class"></div>
					<div id="img_upload_form" class="img_hash_join_class hidden_class" method="POST">
							<a class="img-btn"><span> 이미지 첨부 </span></a>
							<img id="loading" src="{% static 'base_dev/images/register/big-roller2.gif' %}" alt="">
							<div class="form-group img-submit hidden_class">
								 <input class="form-control" id="id_img_file" name="img_file" type="file" required />
							</div>
					</div>

					<div class="img_hash_join_class hidden_class" id="hash_tag_forms" style="margin-top: 10px;" >
						<input id="hash_tag_inputs" type="text" required placeholder="해시태그 추가" data-role="materialtags">
						<div id="hash_tag_div" class="gridly_hashTag"></div>
					</div>
				</fieldset>
				</form>
				<p><input type="hidden" id= "image_file_ids" name="image_file_ids" class="form-control"></p>
				<p><input type="hidden" id= "hash_tag_names" name="hash_tag_names" class="form-control"></p>
				<div role="form-inline" class="form-inline hidden_class" method="POST"  enctype="multipart/form-data" action="">
					<div class="form-group img-submit">
					<!-- {{ register_image_form }} -->
						<tr><td><input class="form-control" id="id_img_file" name="img_file" type="file" required /></td></tr>
						<a href="#"><span id="file_temp_submit" class="img-submit-btn">사진 추가</span></a>
					</div>
				</div>

				<div class="register-btn hidden_class img_hash_join_class">
					<button type="submit" class="join-btn">회원가입</button>
				</div>
			</div>
		</div>
	</div>
</li>

<li>
	<!-- about us 페이지 -->
	<div class="page-3 visual3 col-8">
		<div class="aboutus col-4">
			<div class="null-info col-8">
				<h4>What is NULL?</h4>
				<p>FAST CAMPUS의 웹 프로그래밍 스쿨, 프론트엔드 개발 스쿨 수강생들이 함께 만든 익명 SNS 서비스입니다.<br>
				다양한 해시태그로 나와 맞는 사람들을 찾아보세요.<br> 취미생활부터 최신 트렌드까지, 즐거운 이야기들이 당신을 기다립니다! </p>
			</div>
			<div class="team-member-info col-8">
				<h4>OUR TEAM</h4>
				<div class="our-members">
					<div class="team-member">
						<img src="{% static 'base_dev/images/sjPark.jpg' %}" alt="박상준">
						<strong>Sangjun Park</strong>
						<p>저는 박상준 입니다.</p>
					</div>
					<div class="team-member">
						<img src="{% static 'base_dev/images/shHong.png' %}" alt="홍성호">
						<strong>Sungho Hong</strong>
						<p> 디자인을 통해 영감받고 <br> 개발을 통해 구현한다.</p>
					</div>
					<div class="team-member">
						<img src="{% static 'base_dev/images/wjCho.png' %}" alt="조원준">
						<strong>Wanjun Cho</strong>
						<p>숟가락~!!</p>
					</div>
					<div class="team-member">
						<img src="{% static 'base_dev/images/syYeom.jpg' %}" alt="염서연">
						<strong>Seoyeon Yeom</strong>
						<p>긍정+노력형 개발자 꿈나무</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</li>

</ul>
</div>
</main>
<script src="{% static 'base_dev/js/index-page.js' %}"></script>

{% endblock %}
