{% extends 'base_dev/base.html' %}

{% block content %}
{% load staticfiles %}

<script src="{% static 'base_dev/js/opening/jquery.gridly.js' %}"></script>
<script src="{% static 'base_dev/js/opening/materialize-tags.js' %}"></script>
<script src="{% static 'base_dev/js/profile/profile.js' %}"></script>
<link rel="stylesheet" href="{% static 'base_dev/css/opening/materialize-tags.css' %}">
<link rel="stylesheet" href="{% static 'base_dev/css/opening/jquery.gridly.css' %}">
<link rel="stylesheet" href="{% static 'base_dev/css/profile/profile.css' %}">
<link rel="stylesheet" href="{% static 'base_dev/css/opening/register.css' %}">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
#img_upload_div{ margin-left: 307px; }
.hidden_class{display : none; }
.materialize-tags{display:  block; color: black;}
.n-tag{ color: black;}
</style>

<script>
	function pageEnable(str){
	$('.page_classes').hide();
		switch(str){
			case 'profile' :
					$('#profile_page').show();
			break;
		  case 'mypost' :
					$('#mypost_page').show();
		  break;


		}


	}


		$(document).ready(function(){

			/*
			 * 회원정보 이미지
			 */
			$('.gridly').gridly({
					base: 60,
					gutter: 10,
					columns: 12
			});

		  /*
			 * 이미지 목록 조회
			 */
		  $({{ image|safe }}).each(function(index, item){
				var img_div = $('#img_upload_div').append(
						 $('<div/>').addClass('brick small').attr('id',item.id)
												.append($('<a/>').addClass('delete').text('x'))
						 );

 			 			$('.gridly').append(img_div);
 			 			$('.gridly').gridly();

						var img_div = document.querySelectorAll('.brick')[index];
			 			img_div.style['background-image'] = 'url('+item.url+')';
			 			img_div.style['left'] = 160 * index;
			});


			/*
			 * 이미지 삭제
			 */

			 $(document).on("click", ".gridly .delete", function(event) {
	       		var $this;
	       		event.preventDefault();
	       		event.stopPropagation();
	       		$this = $(this);
	       		$this.closest('.brick').remove();
	       		return $('.gridly').gridly('layout');
	   	});

			/*
			 * 이미지 추가
		   */

			$('.img-btn').click(function(){
	 			$('#id_img_file').trigger('click');
	 		});

			 $("#id_img_file").change(function(){
	 			var _this = $(this);
	 			_this.attr('disabled',true);
	 			var img_length = $('#img_upload_div').find('div').length;
	 			if(img_length==5){
	 				alert('이미지는 5개까지 입력 가능합니다.');
	 				return false;
	 			}

	 			var form_data = new FormData();
	 					form_data.append("img_file",$('input[name=img_file]')[0].files[0])
	 					formAjax('POST', form_data, "{% url 'collection:temp_image' %}"
	 							, 'application/json'
	 							, function(response){
	 								_this.removeAttr('disabled');

	 									var img_div = $('#img_upload_div').append(
	 									     $('<div/>').addClass('brick small').attr('id',response.id)
	 									      	        .append($('<a/>').addClass('delete').text('x'))
	 									   	 );
	 									$('#id_img_file').val('');


	 									var img_div = document.querySelectorAll('.brick')[img_length];
	 									img_div.style['background-image'] = 'url('+response.img_file+')';
	 									img_div.style['left'] = 160 * img_length;

	 									event.preventDefault();
	   								event.stopPropagation();
	   								$('.gridly').append(img_div);
	   								return $('.gridly').gridly();
	 					});
	 		});

	    /*
			 * hash tag 입력
			 */
		 		$('.n-tag').keyup(function(e) {
		 		    if (e.keyCode == 13 || e.keyCode == 9){
		 						$(this).val('');
		 				};
		 		});


			/*
			 * hash_tag 목록
			 */



		});

</script>


<!-- member 리스트 불러오기 -->
<script id="member_list_templ" type="text/x-jquery-tmpl">
  <li class="member-info">
    <a class="member_detail_btn" href="#" data-tags ='${tag_names}' id= '${id}'>
    	<span class="member-img" id= '${id}' data-tags ='${tag_names}'> <img class="image_dir" src="${img_file}" style="width:45px; height:45px;" alt=""> </span>
      <div id="member_tags_${id}">
        <span class="member-name"><strong id= '${id}' data-tags = '${ tag_names }'> ${username} </strong></span>
        <!--<span class="hash-tag" id= 'member_tags_${id}'> ${ tag_names } <span>-->
      </div>
    </a>
  </li>
</script>


<main>
  <div class="wrapper">

    <!-- 좌측 친구 리스트 뷰 -->
    <section class="list-section col-2">
      <div class="list-headline">
        <h2>회원정보 메뉴</h2>
      </div>
      <ul class="list-view">
				<li onclick="pageEnable('profile')">개인정보 수정</li>
				<li onclick="pageEnable('mypost')">내가쓴글 관리</li>
				<li>내가 초대받은 채팅</li>
				<li>나를 좋아하는 사람</li>
				<li>설정</li>
      </ul>
    </section>


    <!-- 우측 search 바 & 맵 뷰-->
		<div id="profile_page" class="page_classes">
    <section class="col-6 profile_body">
      <div class="col-8">
        <div>
          <h2> 개인정보 수정 </h2>
      </div>
			<div class="col-8">
					<div class="">
 					<label for=""> 닉네임 변경 </label>
					<input type="text" name='username' value="{{ request.user.username }}" disabled=true>
					</div>

					<div class="gridly_custom">
					<label for=""> 사진 수정 </label>
					</div>
					<div id="img_upload_div" class='gridly'></div>
					 <button class="img-btn">사진 입력</button>
					 <input id="hash_tag_inputs" type="text" placeholder="해시태그 추가" data-role="materialtags" value="{{ hash_tags }}">
					</div>
			</div>
    </section>

		<div id="img_upload_form" class="img_hash_join_class hidden_class" method="POST">
				<a class="img-btn"><span> 이미지 첨부 </span></a>
				<div class="form-group img-submit hidden_class">
					 <input class="form-control" id="id_img_file" name="img_file" type="file" required />
				</div>
		</div>
		</div>
		<div id="mypost_page" class="page_classes">
			this is my post
		</div>

  </div>
</main>

{% endblock %}
